jQuery(function(b){function f(a){return parseFloat(a.replace(/,/g,""))||0}function k(a){return Math.round(100*a)/100}function t(a){return Math.round(a)}function l(a){return t(a).toLocaleString()}function u(a,b,c,e){1<=b&&(b/=100);if(0==b)return 0;var f=0;return f=52==c?a/r(12*e,m(b,2,12))/4.3333333:26==c?a/r(12*e,m(b,2,12))/2.1666666:a/r(e*c,m(b,2,c))}function m(a,b,c){a=Math.pow(1+a/b,b)-1;return Math.pow(1+a,1/c)-1}function r(a,b){return(1-Math.pow(1+b,-1*a))/b}function z(){p=f(b("#homePrice").val())-
f(b("#downpayment").val());var a=b("#interestRate").val()/100;f(b("#term").val());q=b("#f").val();var d=0;s=f(b("#amortization").val());var c=0,e=0;switch(q){case "aw":d=52;c=u(p,a,12,s);e=u(p,a,52,s);n=c/52+e;break;case "ab":d=26;c=u(p,a,12,s);e=u(p,a,26,s);n=c/26+e;break;default:d=f(q),n=u(p,a,d,s)}w=f(b("#propertyTax").val())/d;x=f(b("#insurance").val())/d;y=k(w+x);var e=p,c=d,g=n;52==c?(e=e*m(a,2,12)/g,g=Math.log(1+m(a,2,12)),c=-12*Math.log(1-e/4.3333333)/g/144):26==c?(e=e*m(a,2,12)/g,g=Math.log(1+
m(a,2,12)),c=-12*Math.log(1-e/2.1666666)/g/144):(e=e*m(a,2,c)/g,g=Math.log(1+m(a,2,c)),c=-1*c*Math.log(1-e)/g/c/c);c=Math.round(100*c)/100;v=Math.round(100*c*d)/100;a=m(a,2,d);c=p;d=v;h=[];h.push({Date:new Date,Payment:0,Interest:0,Principal:0,ExtraPayment:0,Balance:c,TotalInterest:0});for(c=0;c<d;c++){e=h[c];g=k(e.Balance*a);if(e.Balance<=n){h.push({Date:A(e.Date),Payment:e.Balance,Interest:g,Principal:e.Balance-g,ExtraPayment:0,Balance:0,TotalInterest:k(e.TotalInterest+g)});break}var r=k(n-g);h.push({Date:A(e.Date),
Payment:k(n),Interest:g,Principal:r,ExtraPayment:0,Balance:k(e.Balance-r-0),TotalInterest:k(e.TotalInterest+g)})}v=h.length-1;b("#pi").val(k(n));b("#taxInsurance").val(y);b("#total").val(k(n+y));a=v;c=Math.round(a/2);d=B(h[1].Date.getFullYear());c=B(h[c].Date.getFullYear());b("#firstYear").text(d.Date.getFullYear());b("#middleYear").text(c.Date.getFullYear());b("#lastYear").text(h[a].Date.getFullYear());b("#firstYearB").text("$"+l(d.Balance));b("#middleYearB").text("$"+l(c.Balance));b("#firstYearI").text("$"+
l(d.TotalInterest));b("#middleYearI").text("$"+l(c.TotalInterest));b("#lastYearI").text("$"+l(h[a].TotalInterest));a="#p;"+t(f(b("#homePrice").val()))+","+t(f(b("#downpayment").val()))+","+f(b("#interestRate").val())+","+Math.round(f(b("#term").val()))+","+b("#f").val()+","+Math.round(f(b("#amortization").val()))+","+t(f(b("#propertyTax").val()))+","+t(f(b("#insurance").val()));window.location.hash=a}function B(a){for(var b=0;b<h.length;b++)if(h[b+1].Date.getFullYear()>a)return h[b]}function A(a){a=
new Date(a.getTime());"12"==q&&a.addMonths(1);"26"!=q&&"ab"!=q||a.setDate(a.getDate()+14);"52"!=q&&"aw"!=q||a.setDate(a.getDate()+7);return a}function C(){var a=new google.visualization.DataTable;a.addColumn("string","breakdown");a.addColumn("number","amount");a.addRows([["Principal & Interest",k(n)],["Property Tax",k(w)],["Insurance",k(x)]]);(new google.visualization.PieChart(document.getElementById("payment_chart_div"))).draw(a,{title:"Payment Breakdown",width:400,height:300});a=[];a.push(["Year",
"Balance","Interest"]);for(var b=0;b<h.length;b++){var c=h[b];a.push([c.Date.getFullYear().toString(),c.Balance,c.TotalInterest])}a=google.visualization.arrayToDataTable(a);(new google.visualization.AreaChart(document.getElementById("amort_chart_div"))).draw(a,{title:"Amortization",legend:"bottom"})}Date.prototype.addMonths=function(a){var b=this.getMonth()+12*this.getFullYear()+a;a=this.getDate();var c=b/12,b=b%12,e=this.getDaysInMonth(c,b);a>e&&(a=e);this.setYear(c);this.setMonth(b);this.setDate(a)};
Date.prototype.getDaysInMonth=function(a,b){return 1==b&&0==a%4&&(a%100||0==a%400)?29:[31,28,31,30,31,30,31,31,30,31,30,31][b]};var p=0,s=0,n=0,y=0,w=0,x=0,q="0",v=0,h=[];(function(){if("#p;"==window.location.hash.slice(0,3)){var a=window.location.hash.slice(3).split(",");8>a.length||(b("#homePrice").val(l(f(a[0]))),b("#downpayment").val(l(f(a[1]))),b("#interestRate").val(a[2]),b("#term").val(a[3]),b("#f").val(a[4]),b("#amortization").val(a[5]),b("#propertyTax").val(l(f(a[6]))),b("#insurance").val(l(f(a[7]))))}})();
z();b("#homePrice, #downpayment, #propertyTax, #insurance").blur(function(){b(this).html(null);var a=b(this).val(),d=a.indexOf(".");-1!=d&&(a=a.substring(0,d));a=a.replace(/[^\d]/g,"");b(this).val(l(a))});b("#interestRate").blur(function(){b(this).html(null);var a=b(this).val(),a=a.replace(/[^\d.]/g,""),d=a.indexOf(".");-1!=d&&(a=a.substring(0,d+4));b(this).val(a)});b("#amortization").blur(function(){b(this).html(null);var a=b(this).val(),a=a.replace(/[^\d.]/g,""),a=Math.round(a);1>a||30<a?b(this).addClass("field-validation-error"):
(b(this).removeClass("field-validation-error"),b(this).val(a))});b("#doCalculation").click(function(){var a=!0,d='<ul class="error">',c=f(b("#homePrice").val());b("#homePrice").removeClass("validation-error");if(9E6<c||0>=c)b("#homePrice").addClass("validation-error"),d+="<li>The home price must be greater than $0.00 and less than $9,000,000.00</li>",a=!1;var e=f(b("#downpayment").val());b("#downpayment").removeClass("validation-error");e>=c&&(b("#downpayment").addClass("validation-error"),d+="<li>The down payment must be less than home price.</li>",
a=!1);0>e&&(b("#downpayment").addClass("validation-error"),d+="<li>The down payment can not be less than 0.</li>",a=!1);c=f(b("#interestRate").val())/100;b("#interestRate").removeClass("validation-error");if(0>=c||0.3<c)b("#interestRate").addClass("validation-error"),d+="<li>The interest rate must be greater than zero and less than or equal to 30%</li>",a=!1;c=f(b("#term").val());b("#term").removeClass("validation-error");if(1>c||10<c)b("#term").addClass("validation-error"),d+="<li>The term must be greater than zero and less than or equal to 10</li>",
a=!1;b("#f").removeClass("validation-error");b("#f").val()||(b("#f").addClass("validation-error"),d+="<li>Payment Frequency is required. </li>",a=!1);c=f(b("#amortization").val());b("#amortization").removeClass("validation-error");if(1>c||30<c)b("#amortization").addClass("validation-error"),d+="<li>The amortization period must be a minimum of one year and a maximum of 30 years.</li>",a=!1;c=f(b("#propertyTax").val());b("#propertyTax").removeClass("validation-error");if(1>c||1E5<c)b("#propertyTax").addClass("validation-error"),
d+="<li>The property tax must be greater than zero and less than or equal to 100,000.</li>",a=!1;c=f(b("#insurance").val());b("#insurance").removeClass("validation-error");if(1>c||1E5<c)b("#insurance").addClass("validation-error"),d+="<li>The Homeowner's insurance must be greater than zero and less than or equal to 100,000.</li>",a=!1;a?b("#summary").html(""):(d+="</ul>",b("#summary").html(d),b("#pi, #taxInsurance, #total").val(""));if(!a)return!1;z();C();return!1});google.load("visualization","1.0",
{packages:["corechart"]});google.setOnLoadCallback(C)}(jQuery));